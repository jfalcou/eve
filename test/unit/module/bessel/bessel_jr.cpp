//==================================================================================================
/*
  EVE - Expressive Vector Engine
  Copyright : EVE Project Contributors
  SPDX-License-Identifier: BSL-1.0
*/
//==================================================================================================
#include "test.hpp"

#include <eve/module/bessel.hpp>

TTS_CASE_TPL ( "Check eve::cyl_bessel_j over real"
             , eve::test::scalar::ieee_reals
              )
<typename T>(tts::type<T>)
{
  auto constexpr N = 11;
  using a_t  = std::array<T, 16 >;
  using aN_t = std::array<a_t, N >;
  a_t re{-5.2999999999999998e+00, -4.5999999999999996e+00, -3.8999999999999999e+00, -3.2000000000000002e+00, -2.5000000000000000e+00, -1.7999999999999998e+00, -1.1000000000000005e+00, -4.0000000000000036e-01, 2.9999999999999982e-01, 1.0000000000000000e+00, 1.7000000000000002e+00, 2.3999999999999995e+00, 3.0999999999999988e+00, 3.7999999999999998e+00, 4.4999999999999991e+00, 5.2000000000000002e+00};
  aN_t resN16;
  //res are taken from octave 9.2.0 besselj outputs
  int p=0;
  resN16[p] = a_t{-1.1597545976554838e-01,-1.8404077337094055e-01,-1.6994758806898333e-01,-6.5575239920094702e-02,9.9160466709303077e-02,2.6478093556232896e-01,3.6122261706510650e-01,3.1770562022475241e-01,5.8501480583737409e-01,7.3087640216944860e-01,5.6880197719775283e-01,2.4876960808464646e-01,-8.9192832832284519e-02,-3.2054418763173209e-01,-3.7530189159358318e-01,-2.5894539968326319e-01,};
  ++p; //1  1.333e+00
  resN16[p] = a_t{1.4697343298840204e-01,5.8230828874727539e-02,-7.2736739545970389e-02,-1.9677469819171456e-01,-2.6562933202419570e-01,-2.5269825449127742e-01,-1.6579167390396538e-01,-4.8279801188815342e-02,6.6295013865157307e-02,2.9891064265723816e-01,4.8833277759832550e-01,5.3802015546047111e-01,4.2185730918072384e-01,1.8424082846490392e-01,-8.2175746977138683e-02,-2.7663733524344025e-01,};
  ++p; //2  2.333e+00
  resN16[p] = a_t{4.2026562664465673e-02,1.5028377112472163e-01,2.1968211083545852e-01,2.2955415507985366e-01,1.8417748744983745e-01,1.0958684886919279e-01,4.0696592399051532e-02,4.1597210340161015e-03,4.2742062973579300e-03,6.6218644916519687e-02,1.9721022295648286e-01,3.4903056464920651e-01,4.5208084072968158e-01,4.4983599708078759e-01,3.2660515264416784e-01,1.1708009955842254e-01,};
  ++p; //3  3.333e+00
  resN16[p] = a_t{-1.8397795357346625e-01,-2.1069262566792313e-01,-1.9013074350500753e-01,-1.3799177796640805e-01,-7.8168644548834862e-02,-3.1415798132556488e-02,-6.8605362738293502e-03,-2.5027754137259630e-04,1.9263964929954066e-04,1.0109700286520829e-02,5.3028618752804582e-02,1.4065038691298687e-01,2.5869449406825917e-01,3.6818934338869946e-01,4.2087738675627562e-01,3.8170921946253744e-01,};
  ++p; //4  4.333e+00
  resN16[p] = a_t{1.8939224686190737e-01,1.5506786027806496e-01,1.0532770712181774e-01,5.7928715683496709e-02,2.4272231347055650e-02,6.7679590291646174e-03,8.8241532112633787e-04,1.1571322193835856e-05,6.6747981874213704e-06,1.1793569936191894e-03,1.0745144701574307e-02,4.1664954553534951e-02,1.0425140457840276e-01,1.9611021939060896e-01,2.9691690180957242e-01,3.7229069462431719e-01,};
  ++p; //5  5.333e+00
  resN16[p] = a_t{-1.2572006016298587e-01,-8.1464212537127795e-02,-4.3930827876808833e-02,-1.8898493676394928e-02,-5.9750907876243084e-03,-1.1706712671248505e-03,-9.1826862317519160e-05,-4.3443949384562807e-07,1.8785389263193448e-07,1.1139365817878774e-04,1.7505503140447022e-03,9.8063934192224624e-03,3.2761045613296638e-02,7.9079578028478384e-02,1.5096257228438484e-01,2.3877527157799189e-01,};
  ++p; //6  6.333e+00
  resN16[p] = a_t{6.3629257868629524e-02,3.3834661547158820e-02,1.4824984507061004e-02,5.0662632378196543e-03,1.2214893468080507e-03,1.6935218342708366e-04,8.0269801344519689e-06,1.3730975380869413e-08,4.4513283807380267e-09,8.8420269545456844e-06,2.3870040615715793e-04,1.9190161985648572e-03,8.4747738759512539e-03,2.5867543496347838e-02,6.0920306568228715e-02,1.1750473425361366e-01,};
  ++p; //7  7.333e+00
  resN16[p] = a_t{-2.6349864302922316e-02,-1.1703696070990732e-02,-4.2186944538166703e-03,-1.1554649733078719e-03,-2.1378856953648982e-04,-2.1066319954627921e-05,-6.0503013980651014e-07,-3.7472654856907954e-10,9.1083443671157897e-11,6.0534991212430691e-07,2.8001731832160368e-05,3.2174762875873821e-04,1.8670626970418505e-03,7.1455669593477652e-03,2.0516809166925706e-02,4.7454209296197633e-02,};
  ++p; //8  8.333e+00
  resN16[p] = a_t{9.2886056111554823e-03,3.4814708531014944e-03,1.0401912166939906e-03,2.2961788984142881e-04,3.2736927806023280e-05,2.2993124995142569e-06,4.0088396301515925e-08,8.9980666635235531e-12,1.6399765185867347e-12,3.6438423277492385e-08,2.8831625908925078e-06,4.7219310516323554e-05,3.5864103478439296e-04,1.7118377502575830e-03,5.9492936795291999e-03,1.6340471453610651e-02,};
  ++p; //9  9.333e+00
  resN16[p] = a_t{-2.8595873044849826e-03,-9.1032875908720993e-04,-2.2656715598673517e-04,-4.0461536282909876e-05,-4.4576158369999052e-06,-2.2361059643016014e-07,-2.3698041558545969e-09,-1.9289574440427821e-13,2.6362916994236531e-14,1.9571425005678282e-09,2.6456807855052801e-07,6.1642498268421688e-06,6.1114909325855213e-05,3.6249334879952971e-04,1.5176118683676210e-03,4.9190966448620964e-03,};
  ++p; //10  1.033e+01
  resN16[p] = a_t{7.8289684489228596e-04,2.1261686493357002e-04,4.4232777772436793e-05,6.4077384755457370e-06,5.4660377690945072e-07,1.9612204205928512e-08,1.2646210086530898e-10,3.7347420094213856e-15,3.8276105465439233e-16,9.4903399773829474e-11,2.1898663779964632e-08,7.2485480356010010e-07,9.3627202960267181e-06,6.8831331564674566e-05,3.4598518184761763e-04,1.3178241946123280e-03,};
  using eve::spherical;
  auto v0 = T(1.0/3.0);
//  auto h =  eve::half(eve::as<T>());
  for(int j=0; j <= 15 ; ++j)
  {
    auto c = re[j];
    //   auto fac = eve::sqrt(eve::pio_2(eve::as(c))*eve::rec(c));
    for(int i=0; i < N; ++i)
    {
      auto v =  v0+i;
      std::cout<< "v " << v << " j " << j  << " c[" << i << "] = " << c << std::endl;
      auto res = resN16[i][j];
      if(c >= 0) TTS_RELATIVE_EQUAL(eve::bessel_j(v, c), res, tts::prec<T>());
//      TTS_RELATIVE_EQUAL(eve::bessel_j[spherical](v, c), eve::bessel_j(v+h, c)*fac, tts::prec<T>());
    }
  }
};

TTS_CASE_TPL ( "Check eve::cyl_bessel_jn over real"
             , eve::test::scalar::ieee_reals
              )
<typename T>(tts::type<T>)
{
  auto constexpr N = 11;
  using a_t  = std::array<T, 16 >;
  using aN_t = std::array<a_t, N >;
  a_t re{-5.2999999999999998e+00, -4.5999999999999996e+00, -3.8999999999999999e+00, -3.2000000000000002e+00, -2.5000000000000000e+00, -1.7999999999999998e+00, -1.1000000000000005e+00, -4.0000000000000036e-01, 2.9999999999999982e-01, 1.0000000000000000e+00, 1.7000000000000002e+00, 2.3999999999999995e+00, 3.0999999999999988e+00, 3.7999999999999998e+00, 4.4999999999999991e+00, 5.2000000000000002e+00};
  aN_t resN16;
  //res are taken from octave 9.2.0 besselj outputs
  int p=0;
  resN16[p] = a_t{5.3283374925362947e-02,-7.0430716767537677e-02,-1.7887214263588253e-01,-2.1677798790625535e-01,-1.5023758037868426e-01,1.9866510121300779e-02,2.6404905490804303e-01,5.9396688669740216e-01,1.3432948699326057e+00,6.0688750504652922e-01,1.0208951001979610e-01,-2.6361080971812645e-01,-4.2809776774766573e-01,-3.7944112954465492e-01,-1.7649102926536581e-01,7.3768076763741502e-02,};
  ++p; //-1 -1.333e+00
  resN16[p] = a_t{-1.5671280351445993e-01,-1.8509358180132093e-01,-1.3139944887226468e-01,-6.3460966437121069e-03,1.5354285761777339e-01,3.0815545671621902e-01,4.6807466782253232e-01,1.1748522502594041e+00,-3.2936204648846306e+00,-1.0025416437046470e+00,-6.5781200478410107e-01,-3.5330860929322094e-01,-3.0811237851916695e-02,2.3453241788988455e-01,3.6509492104820174e-01,3.3064029522782074e-01,};
  ++p; //-2 -2.333e+00
  resN16[p] = a_t{-1.3213258424081428e-01,-3.6869910363662939e-02,8.9026365629205351e-02,2.1148957403648905e-01,3.1401662850430601e-01,4.3666009242124593e-01,8.7067741254051989e-01,7.2383814483652893e+00,2.7933331484597520e+01,2.0665568781658661e+00,9.2977245826899046e-01,6.5617593115503681e-01,4.5460205837297030e-01,2.1485697663947273e-01,-3.9861516540976139e-02,-2.4332720252159817e-01,};
  ++p; //-3 -3.333e+00
  resN16[p] = a_t{4.0369647579151846e-02,1.4768932491064823e-01,2.3792672398414025e-01,3.1476839211359703e-01,4.3262151559026546e-01,8.2392626437590044e-01,3.2257082944705795e+00,8.3272931314002221e+01,-4.3122486929552133e+02,-8.6413904544027282e+00,-1.8945045473268527e+00,-9.2258903461935127e-01,-6.5353594679556593e-01,-4.9839186288573079e-01,-3.2375705204274524e-01,-1.1226972886228404e-01,};
  ++p; //-4 -4.333e+00
  resN16[p] = a_t{1.8291201515798658e-01,2.5091241023416333e-01,3.1768598306162693e-01,4.4427790953350582e-01,8.3964074640306918e-01,2.6149186645265319e+00,1.8679069826675100e+01,1.3806438071183361e+03,9.5548415417491906e+03,5.5542712817852170e+01,6.4996571390911999e+00,1.9065713872320487e+00,9.5085159064975111e-01,6.5951471263373562e-01,5.1950159364133863e-01,3.8726275234503915e-01,};
  ++p; //-5 -5.333e+00
  resN16[p] = a_t{2.5873176085529170e-01,3.2504420161749159e-01,4.6804212726391825e-01,8.8848427953964637e-01,2.4781330719403729e+00,1.1766422861122216e+01,1.4394272064296950e+02,2.9830676222916576e+04,-2.7559753078123683e+05,-4.7272878730031601e+02,-3.1241002436275330e+01,-5.9622520859408237e+00,-2.0047588227628781e+00,-1.0057644992613846e+00,-6.7676453571094497e-01,-5.3316819171278085e-01,};
  ++p; //-6 -6.333e+00
  resN16[p] = a_t{3.3780599411052348e-01,5.0281327467596215e-01,9.6242923680550030e-01,2.5173363555986477e+00,9.7337270272091878e+00,6.7112031623605105e+01,1.3771291303475743e+03,7.9410405547065625e+05,9.7894684751244560e+06,4.9868976850521849e+03,1.8952231893165597e+02,2.4592326772504951e+01,5.9472432833730560e+00,2.1636838817841855e+00,1.0846810095253465e+00,7.0641558962989537e-01,};
  ++p; //-7 -7.333e+00
  resN16[p] = a_t{5.4860331940885532e-01,1.0595140909684915e+00,2.6577964196257398e+00,9.0759721280383321e+00,4.6839417199252843e+01,4.6050342930498755e+02,1.5713907871238178e+04,2.5116797747014511e+07,-4.1305751586336255e+08,-6.2694641890027342e+04,-1.3808860797995922e+03,-1.2383058365783528e+02,-2.2295805130804446e+01,-6.2065151066858961e+00,-2.3764116392492904e+00,-1.1875877317446575e+00,};
  ++p; //-8 -8.333e+00
  resN16[p] = a_t{1.1803415564548607e+00,2.8753475950786429e+00,9.0327025976844464e+00,3.9080869231243632e+01,2.6505752054174042e+02,3.6851381330837044e+03,2.0814164248616141e+05,9.2015514666839480e+08,2.0184133529289391e+10,9.1453451670202054e+05,1.1724004644045270e+04,7.3215012891426909e+02,9.9538286367745158e+01,2.1791286705424589e+01,6.6606606295093931e+00,2.6431908332396561e+00,};
  ++p; //-9 -9.333e+00
  resN16[p] = a_t{3.1631625813925934e+00,9.3584119781570347e+00,3.5943496732871900e+01,1.9447022178468893e+02,1.7202107197456835e+03,3.3661145951099679e+04,3.1379473419190841e+06,3.8314680980102730e+10,-1.1209276941113259e+12,-1.5179547303143650e+07,-1.1356033592064415e+05,-4.9605453115801456e+03,-5.1285627211513736e+02,-8.9369303776755231e+01,-2.2292701803378101e+01,-7.2841777594080837e+00,};
  ++p; //-10 -1.033e+01
  resN16[p] = a_t{9.9603568434184009e+00,3.5100816953964319e+01,1.6300454672204398e+02,1.0953287578461061e+03,1.2579182520226002e+04,3.4539341247091210e+05,5.3041873856746644e+07,1.7870982905914536e+12,6.9726427944508648e+13,2.8243701514197886e+08,1.2352130172296914e+06,3.7849868961153465e+04,2.9886285134653349e+03,4.1721581956635441e+02,8.5812769073392190e+01,2.3505139585148285e+01,};
  using eve::spherical;
  auto v0 = T(-1.0/3.0);
  auto h =  eve::half(eve::as<T>());
  for(int j=0; j <= 15; ++j)
  {
    auto c = re[j];
    auto fac = eve::sqrt(eve::pio_2(eve::as(c))*eve::rec(c));
    for(int i=0; i < N; ++i)
    {
      auto v =  v0-i;
      std::cout<< "v " << v << " j " << j  << " c[" << i << "] = " << c << std::endl;
      auto res = resN16[i][j];
      if(c >= 0) TTS_RELATIVE_EQUAL(eve::bessel_j(v, c), res, tts::prec<T>());
      TTS_RELATIVE_EQUAL(eve::bessel_j[spherical](v, c), eve::bessel_j(v+h, c)*fac, tts::prec<T>());
    }
  }
};
