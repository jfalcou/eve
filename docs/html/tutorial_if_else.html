<!-- HTML header for doxygen 1.8.20-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="generator" content="Doxygen 1.9.2"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>E.V.E: Conditional operations</title>
  <!--<link href="tabs.css" rel="stylesheet" type="text/css"/> REMOVED BY DOXYSTRAP -->
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <script type="text/javascript" src="godbolt.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxystrap.css" rel="stylesheet" type="text/css"/>
  <!-- DOXYSTRAP BLOCK CHANGE BEGIN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
  <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
  <script type="text/javascript" src="doxystrap.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <!-- Custom input to switch branches -->
  <script>
    function switchBranchAction() {
      var branch = document.getElementById("branch_input").value;
      var form = this;
      window.location.href = window.location.hostname + '/en/' + branch;
    }
  </script>
  <!-- DOXYSTRAP BLOCK CHANGE END -->
</head>
<body>
  <!-- DOXYSTRAP BLOCK CHANGE BEGIN -->
  <nav class="navbar navbar-default" role="navigation">
    <div class="container">
      <div class="navbar-header">
        <a href="index.html" class="navbar-brand">E.V.E 0.1-beta</a>
      </div>
    </div>
  </nav>
  <!-- DOXYSTRAP BLOCK CHANGE END -->
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
    <!-- DOXYSTRAP BLOCK CHANGE BEGIN -->
    <div class="content" id="content">
      <div class="container">
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a href="index.html"><img alt="Logo" src="logo.png" /></a></td>
                <td id="projectalign" style="padding-left: 0.5em;">
                  <div id="projectname">E.V.E
                    &#160;<span id="projectnumber">0.1-beta</span>
                  </div>
                  <!-- BEGIN PROJECT_BRIEF--><div id="projectbrief"></div><!--END PROJECT_BRIEF -->
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="row">
          <div class="col-sm-12 panel " style="padding-bottom: 15px;">
            <div style="margin-bottom: 15px;">
              <!-- DOXYSTRAP BLOCK CHANGE END -->
              <!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Index</span></a></li>
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>References</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li class="current"><a href="pages.html"><span>Documentation</span></a></li>
      <li><a href="tutorials.html"><span>Tutorials</span></a></li>
      <li><a href="glossary.html"><span>Glossary</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Conditional operations </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md16">Explicit Selection</a></li>
<li class="level1"><a href="#autotoc_md17">Conditional Function Syntax</a></li>
<li class="level1"><a href="#autotoc_md18">Conditional Expressions</a><ul><li class="level2"><a href="#autotoc_md19">Mask with alternative</a></li>
<li class="level2"><a href="#autotoc_md20">Context-sensitive mask</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md21">Conclusion</a></li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md__large_hdd_dev_project_eve_doc_tutorial_tutorial02_if_else"></a></p>
<p >When you call a function on one or more <a href="../reference/concepts/simd_value.html#simd_value">SIMD values</a>, you expect the computation to be performed on every elements of its parameters. Sometimes, you may want to make the application of a given function dependent on some condition. Let's explore the functionalities <b>EVE</b> provides for this kind of task.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Explicit Selection</h1>
<p >Let's say the function we want to write computes the product of two values <code>a</code> and <code>b</code> if <code>a</code> is equal to <code>b</code> and their difference otherwise.</p>
<p >The scalar code is looking like:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> square_or_diff( <span class="keywordtype">float</span> a, <span class="keywordtype">float</span>  b) { <span class="keywordflow">return</span> a == b ? a * b : a - b; }</div>
</div><!-- fragment --><p> <br  />
</p>
<p >The SIMD version of this code can't use <code>if</code> nor the ternary operator directly. The correct approach is to use the [if_else][doc_if_else] function.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;eve/function/if_else.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/wide.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> w_t = <a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;float, eve::fixed&lt;4&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> square_or_diff( w_t <span class="keyword">const</span>&amp; a, w_t <span class="keyword">const</span>&amp; b )</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; a == b &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; a*b    &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; a-b    &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__logical_ga74b9090a23d420d6382270233e66f7ac.html#ga74b9090a23d420d6382270233e66f7ac">eve::if_else</a>( a == b, a * b, a - b );</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  w_t v1 = { 1,  2, 3 , 4 };</div>
<div class="line">  w_t v2 = { 1, -2, 10, 4 };</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; square_or_diff(v1,v2) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__logical_ga74b9090a23d420d6382270233e66f7ac_html_ga74b9090a23d420d6382270233e66f7ac"><div class="ttname"><a href="group__logical_ga74b9090a23d420d6382270233e66f7ac.html#ga74b9090a23d420d6382270233e66f7ac">eve::if_else</a></div><div class="ttdeci">constexpr callable_if_else_ if_else</div><div class="ttdoc">Callable object computing the if_else operation.</div><div class="ttdef"><b>Definition:</b> if_else.hpp:99</div></div>
<div class="ttc" id="astructeve_1_1wide_html"><div class="ttname"><a href="structeve_1_1wide.html">eve::wide</a></div><div class="ttdoc">Wrapper for SIMD registers.</div><div class="ttdef"><b>Definition:</b> wide.hpp:65</div></div>
</div><!-- fragment --><p >The [if_else][doc_if_else] call explicitly requests we pass:</p><ul>
<li>the condition, i.e the comparison between <code>a</code> and <code>b</code></li>
<li>the value to use whenever an element of said condition evaluates to <code>true</code>, here the product of <code>a</code> and <code>b</code></li>
<li>the value to use whenever an element of said condition evaluates to <code>false</code>, here the difference of <code>a</code> and <code>b</code></li>
</ul>
<p >The expected result of this program is:</p>
<div class="fragment"><div class="line">(true, false, false, true)</div>
<div class="line">(1, -4, 30, 16)</div>
<div class="line">(0, 4, -7, 0)</div>
<div class="line">(1, 4, -7, 16)</div>
</div><!-- fragment --><p >!!! WARNING Contrary to a <code>if ... else</code> statement, [if_else][doc_if_else] will evaluates all its arguments before performing its selection even if potential short-cut can be applied later on.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Conditional Function Syntax</h1>
<p >Let's define a <code>safe_sqrt</code> function that computes the square root of its argument if it's positive or returns it unchanged otherwise. One can write:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;eve/function/if_else.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/function/sqrt.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/wide.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> w_t = <a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;float, eve::fixed&lt;4&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> safe_sqrt( w_t <span class="keyword">const</span>&amp; a )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__logical_ga74b9090a23d420d6382270233e66f7ac.html#ga74b9090a23d420d6382270233e66f7ac">eve::if_else</a>( a &gt;= 0, <a class="code hl_variable" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7">eve::sqrt</a>(a), a);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  w_t v = { 1, -2, 10, -3.5 };</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; safe_sqrt(v) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7_html_ga6745422ee3727af1a6e34182e8efbcb7"><div class="ttname"><a href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7">eve::sqrt</a></div><div class="ttdeci">constexpr callable_sqrt_ sqrt</div><div class="ttdoc">Callable object computing the square root.</div><div class="ttdef"><b>Definition:</b> sqrt.hpp:98</div></div>
</div><!-- fragment --><p >This code is perfectly valid and will produce the correct result. However, it has some issues:</p><ul>
<li>the code looks like the important part is the test</li>
<li>the code can't be optimized in case the current architecture support masked operations (i.e. AVX512)</li>
</ul>
<p ><b>EVE</b> functions supports &ndash; whenever it makes sense &ndash; a conditional call syntax that solves both issues:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;eve/function/sqrt.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/wide.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> w_t = <a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;float, eve::fixed&lt;4&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> safe_sqrt( w_t <span class="keyword">const</span>&amp; a )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7">eve::sqrt</a>[a &gt;= 0](a);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  w_t v = { 1, -2, 10, -3.5 };</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; safe_sqrt(v) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p >The code of <code>safe_sqrt</code> now plays differently:</p><ul>
<li>the <code>a &gt;= 0</code> expression is evaluated</li>
<li>the <code><a class="el" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7" title="Callable object computing the square root.">eve::sqrt</a>[a &gt;= 0]</code> expression builds a new callable object that will perform the conditional call to <code><a class="el" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7" title="Callable object computing the square root.">eve::sqrt</a></code></li>
<li>this new callable object is then called over <code>a</code></li>
<li>Wherever the condition is true, the <code><a class="el" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7" title="Callable object computing the square root.">eve::sqrt</a></code> function will be applied.</li>
<li>Wherever the condition is false, the value of the first argument of the function will be returned.</li>
</ul>
<p >The fact the conditional syntax builds a new callable object is interesting because it ensures that any optimization over the conditional computation can be captured and that this new callable can be passed as-if to algorithms without having to worry about changing the number of arguments requested.</p>
<p >!!! Tip If required, the callable object produced by the conditional syntax can be stored into a variable:</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> safe_sqrt( w_t <span class="keyword">const</span>&amp; a )</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">auto</span> <span class="keyword">const</span> f = <a class="code hl_variable" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7">eve::sqrt</a>[a &gt;= 0];</div>
<div class="line">  <span class="keywordflow">return</span> f(a);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md18"></a>
Conditional Expressions</h1>
<p >If passing a simple logical expression is the most common use-case of the conditional syntax, one may requires more flexibility. To do so, <b>EVE</b> provides various objects to express more interesting conditions.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Mask with alternative</h2>
<p >One may want to use the conditional syntax to call a function but instead of returning the first argument if the condition is false, one may want to return an arbitrary value. Another use case could be that you want to use a given condition but you happen to just have computed its complement. You may want to not recompute the proper condition but use the already computed complement.</p>
<p >Both those use cases are handled by the <a href="../reference/types/mask.html#eve::if_">if_</a> and <a href="../reference/types/mask.html#eve::if_not_">if_not_</a> helpers. Those helpers are used to wrap a logical expression so that either an alternative value can be specified or the logical expression will be interpreted as its complement.</p>
<p >Let's modify <code>safe_sqrt</code> so that, if the argument is not positive, 0 is returned instead.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;eve/function/sqrt.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/wide.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> w_t = <a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;float, eve::fixed&lt;4&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> safe_sqrt_old( w_t <span class="keyword">const</span>&amp; a )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7">eve::sqrt</a>[ eve::if_(a &gt;= 0) ](a);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> safe_sqrt( w_t <span class="keyword">const</span>&amp; a )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7">eve::sqrt</a>[ eve::if_(a &gt;= 0).else_(0) ](a);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  w_t v = { 1, -2, 10, -3.5 };</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; safe_sqrt_old(v) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; safe_sqrt(v) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p >The output is then:</p>
<div class="fragment"><div class="line">(1, -2, 3.16228, -3.5)</div>
<div class="line">(1, 0, 3.16228, 0)</div>
</div><!-- fragment --><p >The same thing can be achieved with <a href="../reference/types/mask.html#eve::if_not_">if_not_</a>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;eve/function/sqrt.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/wide.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> w_t = <a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;float, eve::fixed&lt;4&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> safe_sqrt_old( w_t <span class="keyword">const</span>&amp; a )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7">eve::sqrt</a>[ eve::if_not_(a &lt; 0) ](a);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> safe_sqrt( w_t <span class="keyword">const</span>&amp; a )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga6745422ee3727af1a6e34182e8efbcb7.html#ga6745422ee3727af1a6e34182e8efbcb7">eve::sqrt</a>[ eve::if_not_(a &lt; 0).else_(0) ](a);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  w_t v = { 1, -2, 10, -3.5 };</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; safe_sqrt_old(v) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; safe_sqrt(v) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p >The output is then:</p>
<div class="fragment"><div class="line">(1, -2, 3.16228, -3.5)</div>
<div class="line">(1, 0, 3.16228, 0)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Context-sensitive mask</h2>
<p >Some algorithms require conditional function calls but use logical expression relative to the element index inside a <a href="../reference/concepts/simd_value.html#simd_value">SIMD value</a> rather than its value. One may want for example to not compute an expression on the first and last element of such <a href="../reference/concepts/simd_value.html#simd_value">SIMD values</a>.</p>
<p >Let's write a function that computes the differences between two vectors in multiple scenarios: not using the first elements and not using the last elements.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;eve/function/sub.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/wide.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> w_t = <a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;float, eve::fixed&lt;4&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> sub_not_first( w_t <span class="keyword">const</span>&amp; a, w_t <span class="keyword">const</span>&amp; b )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga13ddd05c1c516674e73d2ed018fa5d5a.html#ga13ddd05c1c516674e73d2ed018fa5d5a">eve::sub</a>[ eve::ignore_first(1) ](a,b);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> sub_not_last( w_t <span class="keyword">const</span>&amp; a, w_t <span class="keyword">const</span>&amp; b )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga13ddd05c1c516674e73d2ed018fa5d5a.html#ga13ddd05c1c516674e73d2ed018fa5d5a">eve::sub</a>[ eve::ignore_last(1) ](a,b);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  w_t v = { 10, 20, 30, 40 };</div>
<div class="line">  w_t w = {  4,  3,  2,  1 };</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; sub_not_first(v,w) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; sub_not_last(v,w) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__arithmetic_ga13ddd05c1c516674e73d2ed018fa5d5a_html_ga13ddd05c1c516674e73d2ed018fa5d5a"><div class="ttname"><a href="group__arithmetic_ga13ddd05c1c516674e73d2ed018fa5d5a.html#ga13ddd05c1c516674e73d2ed018fa5d5a">eve::sub</a></div><div class="ttdeci">constexpr callable_sub_ sub</div><div class="ttdoc">Callable object performing the difference of multiple values.</div><div class="ttdef"><b>Definition:</b> sub.hpp:88</div></div>
</div><!-- fragment --><p >The output is then:</p>
<div class="fragment"><div class="line">(10, 17, 28, 39)</div>
<div class="line">(6, 17, 30, 40)</div>
</div><!-- fragment --><p >!!! Tip The <a href="../reference/types/mask.html#eve::ignore_first">ignore_first</a> and <a href="../reference/types/mask.html#eve::ignore_last">ignore_last</a> conditional takes a number of elements as parameter so they can be applied generically on any size of <a href="../reference/concepts/simd_value.html#simd_value">SIMD value</a></p>
<p >But what if we want to apply our operation to every element but the first and last one ? Clearly, calling two operations with two different conditional masks is sub-optimal. <b>EVE</b> provides some more conditional expression to express just that like <a href="../reference/types/mask.html#eve::keep_between">keep_between</a>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;eve/function/sub.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/wide.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> w_t = <a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;float, eve::fixed&lt;4&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> sub_not_first_nor_last( w_t <span class="keyword">const</span>&amp; a, w_t <span class="keyword">const</span>&amp; b )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga13ddd05c1c516674e73d2ed018fa5d5a.html#ga13ddd05c1c516674e73d2ed018fa5d5a">eve::sub</a>[ eve::keep_between(1,2) ](a,b);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  w_t v = { 10, 20, 30, 40 };</div>
<div class="line">  w_t w = {  4,  3,  2,  1 };</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; sub_not_first_nor_last(v,w) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p >The output is then:</p>
<div class="fragment"><div class="line">(10, 17, 28, 40)</div>
</div><!-- fragment --><p >In this case, we used <a href="../reference/types/mask.html#eve::keep_between">keep_between</a> with ad-hoc indexes, which makes the code a bit too size dependent. One can also use the same conditional but use <a href="../reference/types/mask.html#eve::ignore_first">ignore_first</a> and <a href="../reference/types/mask.html#eve::ignore_last">ignore_last</a> as parameters, keeping the relative aspect of the code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;eve/function/sub.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/wide.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using</span> w_t = <a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;float, eve::fixed&lt;4&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> sub_not_first_nor_last( w_t <span class="keyword">const</span>&amp; a, w_t <span class="keyword">const</span>&amp; b )</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__arithmetic_ga13ddd05c1c516674e73d2ed018fa5d5a.html#ga13ddd05c1c516674e73d2ed018fa5d5a">eve::sub</a>[ eve::keep_between(eve::ignore_first(1),eve::ignore_last(1)) ](a,b);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">  w_t v = { 10, 20, 30, 40 };</div>
<div class="line">  w_t w = {  4,  3,  2,  1 };</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; sub_not_first_nor_last(v,w) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p >The output is the same obviously:</p>
<div class="fragment"><div class="line">(10, 17, 28, 40)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md21"></a>
Conclusion</h1>
<p >Conditional operations on <a href="../reference/concepts/simd_value.html#simd_value">SIMD values</a> is a good way to keep a high level code over some complex computations. <b>EVE</b> provides different levels of abstraction for such operations as well as various helpers to specify how the conditions can be computed based either on values or indexes. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.20-->
<!-- start footer part -->
</div> <!-- DOXYSTRAP RELATED -->
</div> <!-- DOXYSTRAP RELATED -->
</div> <!-- DOXYSTRAP RELATED -->
</div> <!-- DOXYSTRAP RELATED -->
</div> <!-- DOXYSTRAP RELATED -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Sep 21 2021 09:27:34 for E.V.E by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
