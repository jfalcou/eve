<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>E.V.E: Frequency Scaling.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="godbolt.js"></script>
<script type="text/javascript" src="fragment.js"></script>
<script type="text/javascript" src="paragraph.js"></script>
<script type="text/javascript">
  DoxygenAwesomeParagraphLink.init()
  DoxygenAwesomeFragmentCopyButton.init()
  SendToGodbolt.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<a href="https://github.com/jfalcou/eve" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="40" height="40" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr  style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">E.V.E
   </div>
   <div id="projectbrief">v2023.02.15</div>
  </td>
 </tr>
   <tr><td colspan="2" style="padding: 20px 0px 0px 0px;">        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td></tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('freqscale.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Frequency Scaling.</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In SIMD programming there is a known issue of processor frequency scaling: when working with wider registers, in order to avoid overheating, some processors limit their CPU frequency. There are a lot of situations where this can happen but it is a noticeable problem mostly for 64 byte registers on intel avx512 cpus.</p>
<p>This is why, for example, if you look at libc, it at most uses 32 byte registers: sure you might speed up the strlen somewhat but then all the code after will be slower.</p>
<p>For big datasets the price of lower frequency is often outweighed by processing more numbers in open operation and seed ups of 15% are not unheard of.</p>
<p>For us, This lead to a dilemma in the API design: if the user is on the AVX512 system, most likely they expect the register to be 64 bytes. But we suspect this is not what they actually want. So we decided that <code><a class="el" href="structeve_1_1wide.html" title="Wrapper for SIMD registers.">eve::wide</a></code> on avx512 is by default 64 bytes but algorithms by default use 32 bytes. If you want to get an algorithm to use 64 byte you can pass <code><a class="el" href="group__algo__traits_ga31ef5302d899fb36aeff5146a7187cef.html#ga31ef5302d899fb36aeff5146a7187cef" title="You can find more explanations in the &#39;frequency scaling tutorial&#39;. On intel using 64 byte registers ...">eve::algo::allow_frequency_scaling</a></code> trait. There are also typedefs <code>nofs_wide</code>, <code>nofs_logical</code> where <code>nofs</code> stands for "no frequency scaling".</p>
<p>If you would like the default register size to be 64 bytes on AVX512, for example because you are on AMD where this problem does not exist, or you just have a domain where that makes sense - you can define EVE_AVX512_DEFAULT_64_BYTES in your compiler options.</p>
<dl class="section note"><dt>Note</dt><dd>Other than on avx512 on intel we always use the maximum width of the register, since we expect the compiler to do it anyways and it is usually accepted. If you want to set a specific cardinal for an algorithm, you can always use <code><a class="el" href="group__algo__traits_ga129b5b6d565ac288ce78eec6ecbb5e0b.html#ga129b5b6d565ac288ce78eec6ecbb5e0b" title="A trait that overrides all other cardinal selection and just says to use a certain one....">eve::algo::force_cardinal</a></code>.</dd></dl>
<div class="fragment"><div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;eve/module/core.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;eve/module/algo.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;span&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef EVE_AVX512_DEFAULT_64_BYTES</span></div>
<div class="line"><span class="keyword">static_assert</span>(eve::current_api != eve::avx512 || <a class="code hl_variable" href="group__arch_gab4d8e703ad1e3e94918f3a3ff44e1324.html#gab4d8e703ad1e3e94918f3a3ff44e1324">eve::nofs_cardinal_v&lt;std::int8_t&gt;</a> == 32);</div>
<div class="line"><span class="keyword">static_assert</span>(eve::current_api != eve::avx512 || eve::expected_cardinal_v&lt;std::int8_t&gt; == 64);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">// EVE_AVX512_DEFAULT_64_BYTES</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> find_small_array(std::span&lt;const int&gt; a)</div>
<div class="line">  -&gt; std::span&lt;const int&gt;::iterator</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__algos_gadf0762ce0ad64c41ff1eb704a436894d.html#gadf0762ce0ad64c41ff1eb704a436894d">eve::algo::find_if</a>(a, [](<a class="code hl_struct" href="structeve_1_1wide.html">eve::nofs_wide&lt;int&gt;</a> x) { <span class="keywordflow">return</span> x &lt; 0; });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> find_large_array(std::span&lt;const int&gt; a)</div>
<div class="line">  -&gt; std::span&lt;const int&gt;::iterator</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__algos_gadf0762ce0ad64c41ff1eb704a436894d.html#gadf0762ce0ad64c41ff1eb704a436894d">eve::algo::find_if</a>[<a class="code hl_variable" href="group__algo__traits_ga31ef5302d899fb36aeff5146a7187cef.html#ga31ef5302d899fb36aeff5146a7187cef">eve::algo::allow_frequency_scaling</a>](a,</div>
<div class="line">    [](<a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;int&gt;</a> x) { <span class="keywordflow">return</span> x &lt; 0; });</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> find_use_4_ints(std::span&lt;const int&gt; a)</div>
<div class="line">  -&gt; std::span&lt;const int&gt;::iterator</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_variable" href="group__algos_gadf0762ce0ad64c41ff1eb704a436894d.html#gadf0762ce0ad64c41ff1eb704a436894d">eve::algo::find_if</a>[<a class="code hl_variable" href="group__algo__traits_ga129b5b6d565ac288ce78eec6ecbb5e0b.html#ga129b5b6d565ac288ce78eec6ecbb5e0b">eve::algo::force_cardinal&lt;4&gt;</a>](a,</div>
<div class="line">    [](<a class="code hl_struct" href="structeve_1_1wide.html">eve::wide&lt;int, eve::fixed&lt;4&gt;</a>&gt; x) { <span class="keywordflow">return</span> x &lt; 0; });</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.20-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</div> <!-- DOXYSTRAP RELATED -->
</div> <!-- DOXYSTRAP RELATED -->
</div> <!-- DOXYSTRAP RELATED -->
</div> <!-- DOXYSTRAP RELATED -->
</div> <!-- DOXYSTRAP RELATED -->
</body>
</html>
